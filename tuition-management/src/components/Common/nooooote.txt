import React, { useState } from 'react';
import axios from 'axios';

const SUPPORTED_FORMATS = [
  'application/zip',
  'application/xml',
  'application/xhtml+xml',
  'text/plain',
  'image/svg+xml',
  'application/rtf',
  'application/pdf',
  'image/jpeg',
  'image/png',
  'image/jpg',
  'audio/ogg',
  'application/json',
  'text/html',
  'image/gif',
  'text/csv',
];

function FileUploader() {
  const [selectedFiles, setSelectedFiles] = useState([]);
  const [uploadProgress, setUploadProgress] = useState(0);

  const handleFileSelect = (event) => {
    const files = Array.from(event.target.files);
    setSelectedFiles((prevFiles) => [...prevFiles, ...files]);
  };

  const handleUpload = () => {
    const formData = new FormData();
    selectedFiles.forEach((file) => {
      formData.append('files', file);
    });

    const config = {
      onUploadProgress: (progressEvent) => {
        const progress = Math.round((progressEvent.loaded / progressEvent.total) * 100);
        setUploadProgress(progress);
      },
    };

    axios.post('/api/upload', formData, config)
      .then((response) => {
        console.log(response.data);
      })
      .catch((error) => {
        console.log(error);
      });
  };

  return (
    <div>
      <h2>File Uploader</h2>
      <div>
        <input type="file" accept={SUPPORTED_FORMATS.join(',')} multiple onChange={handleFileSelect} />
        <button onClick={handleUpload}>Upload</button>
      </div>
      <div>
        {selectedFiles.map((file, index) => (
          <div key={index}>
            <p>{file.name}</p>
            {SUPPORTED_FORMATS.includes(file.type) && (
              <FilePreview file={file} />
            )}
          </div>
        ))}
      </div>
      {uploadProgress > 0 && (
        <progress value={